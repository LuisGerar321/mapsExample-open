<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <style>
      .info-container {
        font-size: 20px;
      }
    </style>
  </head>
  <body>
    <div id="map" style="height: 50vh; width: 100vw"></div>
    <div class="info-container">
      <h2>Información de Ubicación y Orientación:</h2>
      <p>Latitud: <span id="lat-span">---</span></p>
      <p>Longitud: <span id="long-span">---</span></p>
      <p>Orientación: <span id="orientation-span">---</span> grados</p>
    </div>
    <script>
      let map;
      let marker;
      let userOrientation = 0;

      function geoFindMe() {
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition(showPosition, handleError, {
            enableHighAccuracy: true,
          });
        }
      }

      function handleError(error) {
        console.error("Error al obtener la ubicación: " + error.message);
      }

      function handleOrientation(event) {
        userOrientation = event.alpha || 0;
        userOrientation = (userOrientation + 360) % 360;
        document.getElementById("orientation-span").textContent =
          userOrientation.toFixed(2);

        if (marker) {
          const icon = marker.getIcon();
          icon.options.rotationAngle = userOrientation;
          marker.setIcon(icon);
        }
      }

      function showPosition(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        document.getElementById("lat-span").textContent = latitude.toFixed(6);
        document.getElementById("long-span").textContent = longitude.toFixed(6);

        if (!map) {
          map = L.map("map").setView([latitude, longitude], 19);
          L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 20.5,
            attribution:
              '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
          }).addTo(map);
        }

        if (!marker) {
          marker = L.marker([latitude, longitude], {
            rotationAngle: userOrientation,
          }).addTo(map);
        } else {
          marker.setLatLng([latitude, longitude]);
        }

        map.setView([latitude, longitude]);
      }

      document.addEventListener("DOMContentLoaded", function () {
        geoFindMe();
      });

      if (window.DeviceOrientationEvent) {
        window.addEventListener("deviceorientation", handleOrientation);
      }
    </script>
  </body>
</html>
