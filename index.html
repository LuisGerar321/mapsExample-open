<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <link rel="stylesheet" type="text/css" href="styles.css" />
  </head>
  <body>
    <script>
      const isADifferentPos = (
        prevLatitude,
        prevLongitude,
        latitude,
        longitude
      ) => {
        return prevLatitude !== latitude || prevLongitude !== longitude;
      };

      let map;
      let prevLatitude;
      let prevLongitude;
      let latitude;
      let longitude;
      let marker;

      function geoFindMe() {
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition(showPosition);
          function showPosition(position) {
            latitude = position.coords.latitude;
            longitude = position.coords.longitude;

            if (!map) {
              map = L.map("map").setView([latitude, longitude], 19);
              L.tileLayer(
                "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                {
                  maxZoom: 20.5,
                  attribution:
                    '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                }
              ).addTo(map);

              marker = L.marker([latitude, longitude]).addTo(map);
            } else {
              if (
                isADifferentPos(
                  prevLatitude,
                  prevLongitude,
                  latitude,
                  longitude
                )
              ) {
                marker.setLatLng([latitude, longitude]);
                map.setView([latitude, longitude, map.getZoom()]);
              }
            }

            prevLatitude = latitude;
            prevLongitude = longitude;
          }
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        geoFindMe();
      });
    </script>
    <div id="map" style="height: 100vh; width: 100vw"></div>
  </body>
</html>
